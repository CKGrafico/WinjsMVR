/*
    WinJS MVR a simple library to do better and easy apps in Windows 8 with WinJS
    Inspired in Backbone but more simple and oriented to WinJS
    author: @CKGrafico
    version: beta-0.9.1
*/
(function(e,t,n){"use strict";var r=Windows.Networking.Connectivity.NetworkInformation;var i=Windows.Networking.Connectivity.NetworkConnectivityLevel;var s=WinJS.Class.define(function(){},{baseConstructor:function(e){var t=e;n.each(t.events,function(e,n){var r=n.split("/");var i;if(r.length===2){var s=r[0];i=r[1];if(t[e]){t[s].on(i,t[e],t)}else{debugger;console.log(t[e])}}else{i=n;if(t[e]){t.on(i,t[e],t)}else{debugger;console.log(t[e])}}})},options:{},events:{},initialize:function(){},trigger:function(e,t){this.dispatchEvent(e,t)},on:function(e,t,r){this.addEventListener(e,n.bind(t,r||this))},off:function(e,t,r){WinJS.Application.removeEventListener(e,n.bind(t,r||this))},once:function(e,t,r){var i=this;this.on(e,function(){n.bind(t,r||i);i.off()})}});WinJS.Class.mix(s,WinJS.Utilities.eventMixin);var o=WinJS.Class.derive(s,function(e){this.customConstructor(e)},{customConstructor:function(e){n.extend(this.options,e);if(this.model){var r=this.model;this.model=new r}this.$el=t("<"+this.tagName+"/>").addClass(this.className).attr("id",this.idName);this.el=this.$el[0];var i=this;n.each(this.domEvents,function(e,r){var s=r.split(" ");var o=s[0];var u=s[1]||"";var a;if(i[e]){a=n.bind(i[e],i)}else{debugger;console.log(i[e])}var f=i.$el.attr("id");var l=i.$el.prop("tagName").toLowerCase();u=f?l+"#"+f+" "+u:l+u;t("body").on(o,u,a)});this.initialize();this.baseConstructor(this)},tagName:"div",className:"",idName:"view"+Math.random().toString(36).substr(2,6),templatesPath:"/templates/",templatesExtension:".hbs",templateName:null,template:function(e){if(this.templateName){return t("<div/>").loadFromTemplate({template:this.templateName,path:this.templatesPath,extension:this.templatesExtension,data:n.extend({},e,this.options)}).html()}},dom:{},classes:{},events:{},domEvents:{},model:null,render:function(){return this}});var u=WinJS.Class.derive(s,function(e){this.customConstructor(e)},{customConstructor:function(e){this.collection=[];n.extend(this.options,e);this.set("url",this.options.url||this.get("url")||null);this.baseConstructor(this);this.initialize()},attributes:{},get:function(e){if(!e){return this.attributes}else{return this.attributes[e]||null}},set:function(e,t){this.attributes[e]=t},toString:function(){return JSON.stringify(this.attributes)},collection:null,getJSON:function(e,r){var i=this;var s=this.get("url");if(s){t.ajax({url:s,async:e.async||false,data:e||{}}).done(function(e){var s;if(typeof e==="string"){s=t.parseJSON(e)}else{s=e}if(typeof s==="object"){var o;for(o in s){break}s=s[o]}n.each(s,i.addToCollection,i);i.trigger("collection.Fill",s);if(r){r(e)}})}},addToCollection:function(e){var t=this.collection.length;e=n.extend(e,{_id:t});this.collection.push(e);this.trigger("collection.Add",e)},resetCollection:function(){this.collection=[];this.trigger("collection.Reset")}});var a=WinJS.Class.derive(s,function(e){n.extend(this.options,e);this.$wrapper=t(this.options.wrapper)||t("body");this.pages=this.options.pages||{};WinJS.Navigation.addEventListener("navigated",n.bind(this.onNavigate,this));this.baseConstructor(this);this.initialize()},{navigate:function(e){WinJS.Navigation.navigate(e)},history:function(){return WinJS.Navigation.history},location:function(){return WinJS.Navigation.location},back:function(e,t){WinJS.Navigation.back(e).done(t)},addPage:function(e,t){this.pages[e]=t},onNavigate:function(e){var t=e.detail.location;var n=this.pages[t];var r=n.render();this.$wrapper.html(r.$el)}});WinJS.Class.extend=function(e,t,n,r){if(typeof t==="object"){return WinJS.Class.derive(e,function(e){this.customConstructor(e)},t,n)}else{return WinJS.Class.derive(e,t,n,r)}};var f=WinJS.Class.define(function(){var e=t("<progress/>").css({position:"absolute",width:"160px",height:"160px",padding:"40px",background:"rgba(0, 0, 0, 0.8)",color:"#FFF",margin:"-100px -100px 0 0",top:"50%",left:"50%","z-index":"1000","border-radius":"6px"}).addClass("win-ring win-large");this.$loading=t("<div/>").css({position:"absolute",top:"0",left:"0",display:"none",height:"100%",width:"100%"}).html(e);t("body").append(this.$loading)},{alert:function(e){var t={text:null,btn1:"Accept",btn2:null,callback1:null,callback2:null,time:100};n.extend(t,e);if(!ShowingMessage){ShowingMessage=true;this.toggleLoading("fade");setTimeout(function(){var e=new Windows.UI.Popups.MessageDialog(t.text);e.commands.append(new Windows.UI.Popups.UICommand(t.btn1,t.callback1));if(t.btn2){e.commands.append(new Windows.UI.Popups.UICommand(t.btn2,t.callback2))}this.toggleLoading("fade");e.showAsync().done(function(){ShowingMessage=false})},t.time)}},haveInternet:function(){var e=r.getInternetConnectionProfile();if(e==null){return false}var t=e.getNetworkConnectivityLevel();if(t==i.none||t==i.localAccess||t==i.constrainedInternetAccess){return false}return true},internetMessage:function(){if(t("#nointernet").length==0){t("body").prepend("<div id='nointernet' style='position: absolute;width: 100%;height: 100%;background: rgba(255,255,255,0.6);z-index: 100000;font-weight: bold;text-align: center;color: rgba(0,0,0,0.4);font-size: 6em;'>No Internet</div>")}if(this.haveInternet()){t("#nointernet").remove()}},needInternetAction:function(e){var t={callback:null,param:null};n.extend(t,e);if(this.haveInternet()){if(t.callback){if(t.param){t.callback(t.param)}else{t.callback()}}}else{this.internetMessage();var r=this;setTimeout(function(){r.needInternetAction(t)},100)}},toggleLoading:function(e){if(e){this.$loading.fadeToggle()}else{this.$loading.toggle()}}});var l=new f;WinJS.Namespace.define("WinjsMVR",{View:o,Model:u,Router:a,Tools:l})})(window,jQuery,_)
/*
    WinJS MVR a simple library to do better and easy apps in Windows 8 with WinJS
    Inspired in Backbone but more simple and oriented to WinJS
    author: @CKGrafico
    version: 1.0.0
*/
(function(e,t,n){"use strict";var r=Windows.Networking.Connectivity.NetworkInformation;var i=Windows.Networking.Connectivity.NetworkConnectivityLevel;var s=WinJS.Class.define(function(){},{baseConstructor:function(e){var t=e;this.configEvents()},options:{},events:{},initialize:function(){},trigger:function(e,t){this.dispatchEvent(e,t||{})},on:function(e,t,r){this.addEventListener(e,n.bind(t,r||this))},off:function(e,t,r){this.removeEventListener(e,n.bind(t,r||this))},once:function(e,t,r){var i=this;this.on(e,function(){n.bind(t,r||i);i.off()})},destroy:function(){if(this.events){this.configEvents(false)}if(this.domEvents){this.configDomEvents(false)}n.each(this,function(e){e=null})},configEvents:function(e){var t=this;n.each(this.events,function(n,r){var i=r.split("/");var s;if(i.length===2){var o=i[0];s=i[1];if(t[n]){if(e){t[o].off(s)}else{t[o].on(s,t[n],t)}}else{console.error(t[n])}}else{s=r;if(t[n]){if(e){t.off(s)}else{t.on(s,t[n],t)}}else{console.error(t[n])}}})}});WinJS.Class.mix(s,WinJS.Utilities.eventMixin);var o=WinJS.Class.derive(s,function(e){this.customConstructor(e)},{customConstructor:function(e){if(!this.idName){this.idName="view-"+Math.random().toString(36).substr(2,6)}n.extend(this.options,e);if(this.model){var r=this.model;this.model=new r}this.$el=t("<"+this.tagName+"/>").addClass(this.className).attr("id",this.idName);this.el=this.$el[0];this.configDomEvents();this.initialize();this.baseConstructor(this)},tagName:"div",className:"",idName:null,templatesPath:"/templates/",templatesExtension:".hbs",templateName:null,template:function(e){var t=Handlebars.getTemplate({templateName:this.templateName,templatesPath:this.templatesPath,templatesExtension:this.templatesExtension});return t(n.extend({},this.options,e))},dom:{},classes:{},events:{},domEvents:{},model:null,render:function(){return this},configDomEvents:function(e){var r=this;n.each(this.domEvents,function(i,s){var o=s.split(" ");var u;var a="";var f;n.each(o,function(e,t){switch(t){case 0:u=e;break;default:a+=" "+e}});if(r[i]){f=n.bind(r[i],r)}else{console.error(r[i])}if(e){t(document).off(u,"#"+r.idName+a)}else{t(document).on(u,"#"+r.idName+a,f)}})},afterRender:null});var u=WinJS.Class.derive(s,function(e){this.customConstructor(e)},{customConstructor:function(e){this.attributes={};n.extend(this.attributes,e);this.baseConstructor(this);this.initialize()},attributes:null,get:function(e){if(!e){return this.attributes}else{return this.attributes[e]}},set:function(e,t){this.attributes[e]=t},"delete":function(e){delete this[e]},toString:function(){return JSON.stringify(this.attributes)}});var a=WinJS.Class.derive(s,function(e){this.customConstructor(e)},{customConstructor:function(e){this.collection=[];n.extend(this.options,e);this.baseConstructor(this);this.initialize()},collection:null,model:u,lastId:-1,get:function(e){return n.find(this.collection,function(t){return t.get("id")==e})},set:function(e,t,n){var r=this.collection[e];r.attributes[t]=n;this.trigger("set",r)},extend:function(e,t){var r=this.collection[e];n.extend(r,t);this.trigger("extend",r)},add:function(e){if(e.id){this.lastId=e.id}else{this.lastId++}var t=new this.model(n.extend(e,{id:this.lastId}));this.collection.push(t);this.trigger("add",t)},addSome:function(e){n.each(e,this.add,this);this.trigger("addSome")},remove:function(e){var t=this.collection[e];this.collection.slice(e,1);this.trigger("remove",t)},clear:function(){this.collection=[];this.trigger("clear")},load:function(e){var t;if(typeof e==="string"){t=JSON.parse(e)}else{t=e}var n=this;this.addSome(t);this.trigger("load",this.collection)},toString:function(){return JSON.stringify(n.pluck(this.collection,"attributes"))},toJSON:function(){return n.pluck(this.collection,"attributes")},getJSON:function(e,n){var r=this;if(myUrl){t.ajax({url:e.url,async:e.async||true,data:e.data||{}}).done(function(e){var i;if(typeof e==="string"){i=t.parseJSON(e)}else{i=e}if(typeof i==="object"){var s;for(s in i){break}i=i[s]}r.addSome(i);if(n){n(e)}})}}});var f=WinJS.Class.derive(s,function(e){n.extend(this.options,e);this.$wrapper=t(this.options.wrapper)||t("body");this.pages=this.options.pages||{};WinJS.Navigation.addEventListener("navigated",n.bind(this.onNavigate,this));this.baseConstructor(this);this.initialize()},{navigate:function(e){WinJS.Navigation.navigate(e)},history:function(){return WinJS.Navigation.history},location:function(){return WinJS.Navigation.location},back:function(e,t){WinJS.Navigation.back(e).done(t)},addPage:function(e,t){this.pages[e]=t},removePage:function(e){var t=this.pages[e];if(t){this.pages[e].configEvents(true);this.pages[e].configDomEvents(true);this.pages[e]=null;delete this.pages[e]}},onNavigate:function(e){var t=e.detail.location;this.currentPage=this.pages[t];this.currentPage.render();this.$wrapper.html(this.currentPage.$el);if(this.currentPage.afterRender){this.currentPage.afterRender()}if(this.currentPage.afterNavigate){this.currentPage.afterNavigate()}}});WinJS.Class.extend=function(e,t,n,r){if(typeof t==="object"){return WinJS.Class.derive(e,function(e){this.customConstructor(e)},t,n)}else{return WinJS.Class.derive(e,t,n,r)}};(function(e){e.getTemplate=function(n){var r=n.templatesPath+n.templateName+n.templatesExtension;if(e.templates===undefined||e.templates[name]===undefined){t.ajax({url:r,success:function(t){if(e.templates===undefined){e.templates={}}e.templates[name]=e.compile(t)},async:false})}return e.templates[name]}})(Handlebars);WinJS.Namespace.define("WinjsMVR",{View:o,Model:u,Collection:a,Router:f})})(window,jQuery,_)